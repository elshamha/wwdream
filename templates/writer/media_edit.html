{% extends "base.html" %}

{% block title %}Edit Media File - {{ media_file.title }}{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <!-- Header -->
            <div class="d-flex justify-content-between align-items-center mb-4">
                <div>
                    <h2><i class="fas fa-edit text-primary"></i> Edit Media File</h2>
                    <p class="text-muted mb-0">Update details for your media file</p>
                </div>
                <div>
                    <a href="{% url 'writer:media_detail' media_file.id %}" class="btn btn-secondary">
                        <i class="fas fa-arrow-left"></i> Back to Details
                    </a>
                </div>
            </div>

            <!-- Media Preview -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="fas fa-file text-muted"></i> {{ media_file.title }}
                        <span class="badge bg-{{ media_file.file_type|default:'secondary' }} ms-2">
                            {{ media_file.get_file_type_display }}
                        </span>
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-4">
                            {% if media_file.file_type == 'image' %}
                                <img src="{{ media_file.file.url }}" class="img-fluid rounded" alt="{{ media_file.title }}" style="max-height: 200px;">
                            {% else %}
                                <div class="text-center p-4 bg-light rounded">
                                    <i class="fas fa-file-{{ media_file.file_type|default:'alt' }} text-muted" style="font-size: 3rem;"></i>
                                    <p class="mt-2 mb-0 text-muted">{{ media_file.file_format|upper }} File</p>
                                </div>
                            {% endif %}
                        </div>
                        <div class="col-md-8">
                            <p class="mb-1"><strong>File:</strong> {{ media_file.file.name|default:'N/A' }}</p>
                            <p class="mb-1"><strong>Size:</strong> {{ media_file.file_size_human }}</p>
                            <p class="mb-1"><strong>Format:</strong> {{ media_file.file_format|upper }}</p>
                            <p class="mb-1"><strong>Uploaded:</strong> {{ media_file.upload_date|date:"M d, Y g:i A" }}</p>
                            {% if media_file.project %}
                                <p class="mb-0">
                                    <strong>Project:</strong> 
                                    <a href="{% url 'writer:project_detail' media_file.project.pk %}">{{ media_file.project.title }}</a>
                                </p>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>

            <!-- Edit Form -->
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="fas fa-edit"></i> Edit Details
                    </h5>
                </div>
                <div class="card-body">
                    <form method="post">
                        {% csrf_token %}
                        
                        <!-- Title -->
                        <div class="mb-3">
                            <label for="title" class="form-label">
                                <strong>Title</strong> <span class="text-danger">*</span>
                            </label>
                            <input type="text" class="form-control" id="title" name="title" 
                                   value="{{ media_file.title }}" required>
                            <small class="text-muted">Give your media file a descriptive title</small>
                        </div>

                        <!-- Description -->
                        <div class="mb-3">
                            <label for="description" class="form-label">
                                <strong>Description</strong>
                            </label>
                            <textarea class="form-control" id="description" name="description" 
                                      rows="4" placeholder="Describe this media file...">{{ media_file.description|default:'' }}</textarea>
                            <small class="text-muted">Optional description of the media file</small>
                        </div>

                        <!-- Tags -->
                        <div class="mb-3">
                            <label for="tags" class="form-label">
                                <strong>Tags</strong>
                            </label>
                            <input type="text" class="form-control" id="tags" name="tags" 
                                   value="{{ tags_string }}" 
                                   placeholder="Enter tags separated by commas (e.g., research, character art, reference)">
                            <small class="text-muted">Add tags to help organize and find this file later</small>
                        </div>

                        <!-- Project Assignment -->
                        <div class="mb-4">
                            <label for="project" class="form-label">
                                <strong>Project</strong>
                            </label>
                            <select class="form-select" id="project" name="project">
                                <option value="">No project assigned</option>
                                {% for project in projects %}
                                    <option value="{{ project.id }}" 
                                            {% if media_file.project and project.id == media_file.project.id %}selected{% endif %}>
                                        {{ project.title }}
                                    </option>
                                {% endfor %}
                            </select>
                            <small class="text-muted">Assign this media file to a specific project</small>
                        </div>

                        <!-- Action Buttons -->
                        <div class="d-flex justify-content-between">
                            <div>
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-save"></i> Save Changes
                                </button>
                                <a href="{% url 'writer:media_detail' media_file.id %}" class="btn btn-secondary">
                                    <i class="fas fa-times"></i> Cancel
                                </a>
                            </div>
                            <div>
                                <a href="{% url 'writer:media_view' media_file.id %}" class="btn btn-outline-info" target="_blank">
                                    <i class="fas fa-eye"></i> Preview
                                </a>
                                <a href="{% url 'writer:media_download' media_file.id %}" class="btn btn-outline-success">
                                    <i class="fas fa-download"></i> Download
                                </a>
                            </div>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="card mt-4">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="fas fa-bolt"></i> Quick Actions
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="d-grid">
                                <a href="{% url 'writer:media_library' %}" class="btn btn-outline-primary">
                                    <i class="fas fa-folder"></i> Back to Media Library
                                </a>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="d-grid">
                                <button type="button" class="btn btn-outline-danger" onclick="confirmDelete()">
                                    <i class="fas fa-trash"></i> Delete File
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Delete Confirmation Modal -->
<div class="modal fade" id="deleteModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="fas fa-exclamation-triangle text-danger"></i> Confirm Delete
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <p>Are you sure you want to delete this media file?</p>
                <div class="alert alert-warning">
                    <strong>Warning:</strong> This action cannot be undone. The file will be permanently removed from the system.
                </div>
                <p><strong>File:</strong> {{ media_file.title }}</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <a href="{% url 'writer:media_delete' media_file.id %}" class="btn btn-danger">
                    <i class="fas fa-trash"></i> Delete File
                </a>
            </div>
        </div>
    </div>
</div>

<script>
function confirmDelete() {
    const modal = new bootstrap.Modal(document.getElementById('deleteModal'));
    modal.show();
}

// Auto-save draft functionality
let saveTimeout;
function autoSave() {
    clearTimeout(saveTimeout);
    saveTimeout = setTimeout(() => {
        const formData = new FormData(document.querySelector('form'));
        // Could implement auto-save here if needed
    }, 2000);
}

// Add auto-save to form fields
document.querySelectorAll('input, textarea, select').forEach(field => {
    field.addEventListener('input', autoSave);
});
</script>

<style>
.card-header h5 {
    color: #495057;
}

.badge {
    font-size: 0.75em;
}

.form-label strong {
    color: #495057;
}

.btn-group .btn {
    margin-right: 0.5rem;
}
</style>
{% endblock %}