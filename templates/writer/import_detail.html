{% extends 'base.html' %}
{% load static %}

{% block title %}{{ imported_doc.title }} - Import Details - A Writer's Web Dream{% endblock %}

{% block content %}
<div class="container-fluid p-0">
    <div class="import-detail-hero">
        <div class="container">
            <nav aria-label="breadcrumb" class="mb-4">
                <ol class="breadcrumb glass-breadcrumb">
                    <li class="breadcrumb-item"><a href="{% url 'writer:dashboard' %}">Dashboard</a></li>
                    <li class="breadcrumb-item"><a href="{% url 'writer:personal_library' %}">Personal Library</a></li>
                    <li class="breadcrumb-item active">{{ imported_doc.title|truncatechars:30 }}</li>
                </ol>
            </nav>
            
            <div class="hero-content">
                <div class="row align-items-center">
                    <div class="col-lg-8">
                        <div class="file-icon-large mb-3">
                            <i class="fas fa-file-{{ imported_doc.import_type }} fa-4x"></i>
                        </div>
                        <h1 class="hero-title">{{ imported_doc.title }}</h1>
                        <p class="hero-subtitle">Imported {{ imported_doc.created_at|timesince }} ago</p>
                    </div>
                    <div class="col-lg-4 text-lg-end">
                        <div class="action-buttons">
                            <button class="btn btn-primary btn-lg me-2" onclick="convertToProject()">
                                <i class="fas fa-project-diagram me-2"></i>Convert to Project
                            </button>
                            <button class="btn btn-outline-light btn-lg" onclick="convertToDocument()">
                                <i class="fas fa-file-alt me-2"></i>Convert to Document
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="container mt-5">
        <div class="row">
            <!-- Main Content -->
            <div class="col-lg-8">
                <!-- Import Information Card -->
                <div class="glass-card mb-4">
                    <div class="card-header-modern">
                        <h3><i class="fas fa-info-circle text-info me-2"></i>Import Information</h3>
                    </div>
                    <div class="card-body p-4">
                        <div class="row g-4">
                            <div class="col-md-6">
                                <div class="info-group">
                                    <label class="info-label">Title</label>
                                    <div class="info-value">{{ imported_doc.title }}</div>
                                </div>
                                <div class="info-group">
                                    <label class="info-label">File Type</label>
                                    <div class="info-value">
                                        <span class="badge badge-modern">
                                            <i class="fas fa-file-{{ imported_doc.import_type }} me-1"></i> 
                                            {{ imported_doc.import_type|upper }}
                                        </span>
                                    </div>
                                </div>
                                <div class="info-group">
                                    <label class="info-label">File Size</label>
                                    <div class="info-value">{{ imported_doc.file_size|filesizeformat }}</div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="info-group">
                                    <label class="info-label">Target Project</label>
                                    <div class="info-value">
                                        {% if imported_doc.target_project %}
                                            <a href="{% url 'writer:project_detail' imported_doc.target_project.pk %}" class="project-link">
                                                <i class="fas fa-folder me-1"></i>{{ imported_doc.target_project.title }}
                                            </a>
                                        {% else %}
                                            <span class="text-muted">None</span>
                                        {% endif %}
                                    </div>
                                </div>
                                <div class="info-group">
                                    <label class="info-label">Status</label>
                                    <div class="info-value">
                                        <span class="badge badge-success">
                                            <i class="fas fa-check-circle me-1"></i>Completed
                                        </span>
                                    </div>
                                </div>
                                <div class="info-group">
                                    <label class="info-label">Imported</label>
                                    <div class="info-value">{{ imported_doc.created_at|date:"F d, Y g:i A" }}</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Content Preview Card -->
                <div class="glass-card">
                    <div class="card-header-modern d-flex justify-content-between align-items-center">
                        <h3><i class="fas fa-file-text text-success me-2"></i>Content Preview</h3>
                        <div class="btn-group">
                            <button class="btn btn-sm btn-outline-light" onclick="toggleContent()">
                                <i class="fas fa-eye" id="toggleIcon"></i> <span id="toggleText">Show Full Content</span>
                            </button>
                            <button class="btn btn-sm btn-primary" onclick="copyContent()">
                                <i class="fas fa-copy"></i> Copy
                            </button>
                        </div>
                    </div>
                    <div class="card-body p-4">
                        {% if imported_doc.extracted_content %}
                            <div id="contentPreview" class="content-preview">
                                {{ imported_doc.extracted_content|striptags|truncatewords:100|linebreaks|safe }}
                            </div>
                            <div id="fullContent" class="content-full d-none">
                                {{ imported_doc.extracted_content|striptags|linebreaks|safe }}
                            </div>
                            
                            <!-- Content Statistics -->
                            <div class="content-stats mt-4 pt-4">
                                <div class="row text-center g-3">
                                    <div class="col-6 col-md-3">
                                        <div class="stat-item">
                                            <div class="stat-number text-primary">{{ imported_doc.extracted_content|wordcount }}</div>
                                            <div class="stat-label">Words</div>
                                        </div>
                                    </div>
                                    <div class="col-6 col-md-3">
                                        <div class="stat-item">
                                            <div class="stat-number text-info">{{ imported_doc.extracted_content|length }}</div>
                                            <div class="stat-label">Characters</div>
                                        </div>
                                    </div>
                                    <div class="col-6 col-md-3">
                                        <div class="stat-item">
                                            <div class="stat-number text-warning">~{{ imported_doc.word_count|default:0|floatformat:0 }}</div>
                                            <div class="stat-label">Word Count</div>
                                        </div>
                                    </div>
                                    <div class="col-6 col-md-3">
                                        <div class="stat-item">
                                            <div class="stat-number text-success">{{ imported_doc.extracted_content|linebreaksbr|striptags|split:"

"|length }}</div>
                                            <div class="stat-label">Paragraphs</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        {% else %}
                            <div class="empty-state">
                                <i class="fas fa-exclamation-triangle fa-3x text-warning mb-3"></i>
                                <h4>No content extracted</h4>
                                <p class="text-muted">The document may be empty or in an unsupported format.</p>
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Sidebar -->
            <div class="col-lg-4">
                <!-- Quick Actions -->
                <div class="glass-card mb-4">
                    <div class="card-header-modern">
                        <h5><i class="fas fa-bolt text-warning me-2"></i>Quick Actions</h5>
                    </div>
                    <div class="card-body p-3">
                        <div class="d-grid gap-2">
                            <button class="btn btn-primary" onclick="convertToProject()">
                                <i class="fas fa-project-diagram me-2"></i>Convert to Project
                            </button>
                            <button class="btn btn-outline-primary" onclick="convertToDocument()">
                                <i class="fas fa-file-alt me-2"></i>Convert to Document
                            </button>
                            <button class="btn btn-outline-info" onclick="analyzeContent()">
                                <i class="fas fa-search me-2"></i>Analyze Content
                            </button>
                            <a href="{{ imported_doc.original_file.url }}" class="btn btn-outline-secondary" download>
                                <i class="fas fa-download me-2"></i>Download Original
                            </a>
                            <hr>
                            <button class="btn btn-outline-danger" onclick="confirmImportDelete({{ imported_doc.pk }}, '{{ imported_doc.title|escapejs }}')">
                                <i class="fas fa-trash me-2"></i>Delete Import
                            </button>
                        </div>
                    </div>
                </div>

                <!-- File Details -->
                <div class="glass-card mb-4">
                    <div class="card-header-modern">
                        <h5><i class="fas fa-file text-secondary me-2"></i>File Details</h5>
                    </div>
                    <div class="card-body p-3">
                        <div class="file-preview text-center mb-3">
                            <div class="file-icon-container">
                                <i class="fas fa-file-{{ imported_doc.import_type }} fa-3x"></i>
                            </div>
                            <h6 class="mt-2">{{ imported_doc.original_file.name|slice:"-50:" }}</h6>
                            <p class="text-muted small">{{ imported_doc.file_size|filesizeformat }}</p>
                        </div>
                    </div>
                </div>

                <!-- Navigation -->
                <div class="glass-card">
                    <div class="card-header-modern">
                        <h5><i class="fas fa-compass text-purple me-2"></i>Navigation</h5>
                    </div>
                    <div class="card-body p-3">
                        <div class="d-grid gap-2">
                            <a href="{% url 'writer:personal_library' %}" class="btn btn-outline-light">
                                <i class="fas fa-arrow-left me-2"></i>Back to Library
                            </a>
                            <a href="{% url 'writer:import_document' %}" class="btn btn-outline-light">
                                <i class="fas fa-plus me-2"></i>Import Another
                            </a>
                            <a href="{% url 'writer:dashboard' %}" class="btn btn-outline-light">
                                <i class="fas fa-home me-2"></i>Dashboard
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
/* Import Detail Modern Styling */
body {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    min-height: 100vh;
}

/* Hero Section */
.import-detail-hero {
    background: linear-gradient(135deg, rgba(102, 126, 234, 0.9) 0%, rgba(118, 75, 162, 0.9) 100%);
    padding: 60px 0;
    position: relative;
    overflow: hidden;
}

.import-detail-hero::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grid" width="10" height="10" patternUnits="userSpaceOnUse"><path d="M 10 0 L 0 0 0 10" fill="none" stroke="rgba(255,255,255,0.1)" stroke-width="0.5"/></pattern></defs><rect width="100" height="100" fill="url(%23grid)"/></svg>');
    opacity: 0.3;
}

.hero-content {
    position: relative;
    z-index: 2;
}

.hero-title {
    font-size: 2.5rem;
    font-weight: 700;
    color: #ffffff;
    margin-bottom: 0.5rem;
    text-shadow: 0 2px 4px rgba(0,0,0,0.3);
}

.hero-subtitle {
    font-size: 1.1rem;
    color: rgba(255, 255, 255, 0.9);
    margin-bottom: 0;
}

.file-icon-large {
    color: rgba(255, 255, 255, 0.9);
    filter: drop-shadow(0 4px 8px rgba(0,0,0,0.2));
}

/* Glass Morphism Cards */
.glass-card {
    background: rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(20px);
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 20px;
    box-shadow: 
        0 8px 32px rgba(0, 0, 0, 0.1),
        0 4px 16px rgba(0, 0, 0, 0.1),
        inset 0 1px 1px rgba(255, 255, 255, 0.2);
    transition: all 0.3s ease;
}

.glass-card:hover {
    transform: translateY(-2px);
    box-shadow: 
        0 12px 40px rgba(0, 0, 0, 0.15),
        0 6px 20px rgba(0, 0, 0, 0.1),
        inset 0 1px 1px rgba(255, 255, 255, 0.25);
}

.card-header-modern {
    background: rgba(255, 255, 255, 0.1);
    border-bottom: 1px solid rgba(255, 255, 255, 0.15);
    border-radius: 20px 20px 0 0;
    padding: 1.5rem;
}

.card-header-modern h3,
.card-header-modern h5 {
    color: #ffffff;
    margin: 0;
    font-weight: 600;
    text-shadow: 0 1px 2px rgba(0,0,0,0.1);
}

/* Glass Breadcrumb */
.glass-breadcrumb {
    background: rgba(255, 255, 255, 0.15);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 15px;
    padding: 12px 20px;
}

.breadcrumb-item a {
    color: rgba(255, 255, 255, 0.9);
    text-decoration: none;
    transition: color 0.3s ease;
}

.breadcrumb-item a:hover {
    color: #ffffff;
}

.breadcrumb-item.active {
    color: rgba(255, 255, 255, 0.8);
}

/* Info Groups */
.info-group {
    margin-bottom: 1.5rem;
}

.info-label {
    font-size: 0.875rem;
    font-weight: 600;
    color: rgba(255, 255, 255, 0.8);
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin-bottom: 0.5rem;
    display: block;
}

.info-value {
    font-size: 1rem;
    color: #ffffff;
    font-weight: 500;
}

/* Modern Badges */
.badge-modern {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: #ffffff;
    border: 1px solid rgba(255, 255, 255, 0.2);
    padding: 0.5rem 1rem;
    border-radius: 25px;
    font-weight: 500;
    box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
}

.badge-success {
    background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
    color: #ffffff;
    border: 1px solid rgba(255, 255, 255, 0.2);
    padding: 0.5rem 1rem;
    border-radius: 25px;
    font-weight: 500;
    box-shadow: 0 4px 12px rgba(17, 153, 142, 0.3);
}

/* Content Preview */
.content-preview, .content-full {
    background: rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(10px);
    padding: 2rem;
    border-radius: 15px;
    border: 1px solid rgba(255, 255, 255, 0.15);
    max-height: 400px;
    overflow-y: auto;
    line-height: 1.6;
    color: #ffffff;
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
}

.content-full {
    max-height: 600px;
}

/* Statistics */
.content-stats {
    background: rgba(255, 255, 255, 0.08);
    backdrop-filter: blur(15px);
    border-radius: 15px;
    padding: 2rem;
    border: 1px solid rgba(255, 255, 255, 0.15);
}

.stat-item {
    padding: 1rem;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 12px;
    border: 1px solid rgba(255, 255, 255, 0.15);
    transition: all 0.3s ease;
}

.stat-item:hover {
    background: rgba(255, 255, 255, 0.15);
    transform: translateY(-2px);
}

.stat-number {
    font-size: 1.5rem;
    font-weight: 700;
    margin-bottom: 0.25rem;
    display: block;
}

.stat-label {
    font-size: 0.875rem;
    color: rgba(255, 255, 255, 0.8);
    font-weight: 500;
}

/* File Icon Container */
.file-icon-container {
    width: 80px;
    height: 80px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto 1rem;
    box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
    color: #ffffff;
}

/* Empty State */
.empty-state {
    text-align: center;
    padding: 3rem;
    color: rgba(255, 255, 255, 0.8);
}

.empty-state i {
    margin-bottom: 1rem;
    color: #ffd93d;
    filter: drop-shadow(0 4px 8px rgba(255, 217, 61, 0.3));
}

.empty-state h4 {
    color: #ffffff;
    margin-bottom: 1rem;
}

/* Project Link */
.project-link {
    color: #4fd1c7;
    text-decoration: none;
    font-weight: 500;
    transition: color 0.3s ease;
}

.project-link:hover {
    color: #38ef7d;
}

/* Purple text for specific icons */
.text-purple {
    color: #8B5CF6 !important;
}

/* Action Buttons */
.action-buttons .btn {
    border-radius: 25px;
    padding: 12px 24px;
    font-weight: 600;
    transition: all 0.3s ease;
    border: 2px solid rgba(255, 255, 255, 0.3);
}

.action-buttons .btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
}

/* Responsive Design */
@media (max-width: 768px) {
    .hero-title {
        font-size: 2rem;
    }
    
    .import-detail-hero {
        padding: 40px 0;
    }
    
    .action-buttons {
        margin-top: 2rem;
    }
    
    .action-buttons .btn {
        width: 100%;
        margin-bottom: 0.5rem;
    }
}

/* Override all text colors for contrast */
* {
    color: #ffffff !important;
}

.text-muted {
    color: rgba(255, 255, 255, 0.7) !important;
}

/* Custom scrollbar */
::-webkit-scrollbar {
    width: 8px;
}

::-webkit-scrollbar-track {
    background: rgba(255, 255, 255, 0.1);
    border-radius: 4px;
}

::-webkit-scrollbar-thumb {
    background: rgba(255, 255, 255, 0.3);
    border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
    background: rgba(255, 255, 255, 0.5);
}
</style>

<script>
function toggleContent() {
    const preview = document.getElementById('contentPreview');
    const full = document.getElementById('fullContent');
    const icon = document.getElementById('toggleIcon');
    const text = document.getElementById('toggleText');
    
    if (full.classList.contains('d-none')) {
        preview.classList.add('d-none');
        full.classList.remove('d-none');
        icon.className = 'fas fa-eye-slash';
        text.textContent = 'Show Preview';
    } else {
        preview.classList.remove('d-none');
        full.classList.add('d-none');
        icon.className = 'fas fa-eye';
        text.textContent = 'Show Full Content';
    }
}

function copyContent() {
    const content = document.querySelector('#fullContent:not(.d-none)') || document.querySelector('#contentPreview');
    const text = content.textContent || content.innerText;
    
    navigator.clipboard.writeText(text).then(() => {
        // Show success message
        const btn = event.target.closest('button');
        const originalHTML = btn.innerHTML;
        btn.innerHTML = '<i class="fas fa-check"></i> Copied!';
        btn.classList.remove('btn-outline-primary');
        btn.classList.add('btn-success');
        
        setTimeout(() => {
            btn.innerHTML = originalHTML;
            btn.classList.remove('btn-success');
            btn.classList.add('btn-outline-primary');
        }, 2000);
    });
}

// Convert imported document to project
function convertToProject() {
    if (confirm('Are you sure you want to convert this imported document to a new project? This will analyze chapters and create a structured project.')) {
        // Show loading state
        const btn = event.target.closest('button');
        const originalHTML = btn.innerHTML;
        btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Converting...';
        btn.disabled = true;
        
        // For now, show a success message and redirect to projects
        setTimeout(() => {
            alert('Document conversion feature will be implemented soon! Redirecting to projects...');
            window.location.href = '/writer/projects/';
        }, 1500);
    }
}

// Convert imported document to standalone document  
function convertToDocument() {
    if (confirm('Are you sure you want to convert this imported document to a standalone document?')) {
        // Show loading state
        const btn = event.target.closest('button');
        const originalHTML = btn.innerHTML;
        btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Converting...';
        btn.disabled = true;
        
        // For now, show a success message and redirect to documents
        setTimeout(() => {
            alert('Document conversion feature will be implemented soon! Redirecting to documents...');
            window.location.href = '/writer/documents/';
        }, 1500);
    }
}

// Analyze content for chapters and structure
function analyzeContent() {
    // Show loading state
    const btn = event.target.closest('button');
    const originalHTML = btn.innerHTML;
    btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Analyzing...';
    btn.disabled = true;
    
    // Show analysis results (simulate for now)
    setTimeout(() => {
        // Reset button
        btn.innerHTML = originalHTML;
        btn.disabled = false;
        
        // Show analysis modal or results
        const analysisHtml = `
            <div class="glass-card mt-4" id="analysisResults">
                <div class="card-header-modern">
                    <h5><i class="fas fa-search me-2"></i>Content Analysis Results</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <h6>Document Structure:</h6>
                            <ul class="list-unstyled">
                                <li><i class="fas fa-bookmark me-2"></i>{{ imported_document.estimated_chapters }} potential chapters detected</li>
                                <li><i class="fas fa-align-left me-2"></i>{{ imported_document.word_count }} words total</li>
                                <li><i class="fas fa-file-lines me-2"></i>{{ imported_document.pages }} pages estimated</li>
                            </ul>
                        </div>
                        <div class="col-md-6">
                            <h6>Recommendations:</h6>
                            <ul class="list-unstyled">
                                <li><i class="fas fa-lightbulb me-2 text-warning"></i>Convert to project for chapter management</li>
                                <li><i class="fas fa-edit me-2 text-info"></i>Format appears suitable for structured editing</li>
                                <li><i class="fas fa-check-circle me-2 text-success"></i>Ready for conversion</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        `;
        
        // Remove existing analysis if present
        const existing = document.getElementById('analysisResults');
        if (existing) existing.remove();
        
        // Insert analysis results
        const container = document.querySelector('.container-fluid .row').closest('.container-fluid');
        container.insertAdjacentHTML('beforeend', analysisHtml);
        
        // Scroll to results
        document.getElementById('analysisResults').scrollIntoView({ 
            behavior: 'smooth',
            block: 'start'
        });
        
    }, 1500); // Simulate analysis time
}

// Enhanced page interactions
document.addEventListener('DOMContentLoaded', function() {
    // Add smooth hover effects to glass cards
    document.querySelectorAll('.glass-card').forEach(card => {
        card.addEventListener('mouseenter', function() {
            this.style.transform = 'translateY(-2px)';
        });
        
        card.addEventListener('mouseleave', function() {
            this.style.transform = 'translateY(0)';
        });
    });
    
    // Add click animation to buttons
    document.querySelectorAll('.btn').forEach(btn => {
        btn.addEventListener('click', function(e) {
            if (!this.disabled) {
                this.style.transform = 'scale(0.95)';
                setTimeout(() => {
                    this.style.transform = '';
                }, 150);
            }
        });
    });
    
    // Auto-hide success messages
    setTimeout(() => {
        document.querySelectorAll('.alert-success').forEach(alert => {
            alert.style.opacity = '0';
            alert.style.transition = 'opacity 0.3s ease';
            setTimeout(() => alert.remove(), 300);
        });
    }, 4000);
    
    // Add loading skeleton effect
    function addLoadingEffect(element) {
        element.style.background = 'linear-gradient(90deg, rgba(255,255,255,0.1) 25%, rgba(255,255,255,0.2) 50%, rgba(255,255,255,0.1) 75%)';
        element.style.backgroundSize = '200% 100%';
        element.style.animation = 'loading 1.5s infinite';
    }
    
    // Add CSS for loading animation
    const style = document.createElement('style');
    style.textContent = `
        @keyframes loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }
        
        .glass-card {
            position: relative;
            overflow: hidden;
        }
        
        .glass-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
            transition: left 0.5s ease;
            z-index: 1;
            pointer-events: none;
        }
        
        .glass-card:hover::before {
            left: 100%;
        }
    `;
    document.head.appendChild(style);
});
</script>
{% endblock %}
