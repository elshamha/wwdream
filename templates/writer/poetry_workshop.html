{% extends 'base.html' %}
{% block title %}Poetry Workshop - A Writer's Web Dream{% endblock %}

{% block content %}
<style>
:root {
    --poetry-purple: #9b59b6;
    --poetry-pink: #e91e63;
    --poetry-blue: #3498db;
    --poetry-teal: #00bcd4;
    --poetry-gold: #ffc107;
}

.poetry-workshop {
    min-height: 100vh;
    background: transparent;
    padding: 2rem;
}

.workshop-header {
    text-align: center;
    margin-bottom: 3rem;
    animation: fadeInDown 1s ease;
}

.workshop-title {
    font-size: 3.5rem;
    color: #ffffff;
    font-weight: 300;
    margin-bottom: 1rem;
    font-family: 'Playfair Display', serif;
    text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
}

.workshop-subtitle {
    font-size: 1.2rem;
    color: rgba(255, 255, 255, 0.9);
    font-style: italic;
}

.workshop-container {
    max-width: 1400px;
    margin: 0 auto;
    display: grid;
    grid-template-columns: 1fr 2fr 1fr;
    gap: 2rem;
}

/* Left Panel - Poetry Types */
.poetry-types {
    background: rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(15px);
    border-radius: 20px;
    padding: 2rem;
    border: 1px solid rgba(255, 255, 255, 0.2);
}

.section-title {
    font-size: 1.5rem;
    color: #ffffff;
    margin-bottom: 1.5rem;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.poetry-type-card {
    background: rgba(255, 255, 255, 0.1);
    border-radius: 15px;
    padding: 1rem;
    margin-bottom: 1rem;
    cursor: pointer;
    transition: all 0.3s ease;
    border: 1px solid rgba(255, 255, 255, 0.2);
}

.poetry-type-card:hover {
    background: rgba(255, 255, 255, 0.2);
    transform: translateY(-2px);
}

.poetry-type-card.active {
    background: rgba(255, 255, 255, 0.25);
    border-color: var(--poetry-gold);
}

.type-name {
    font-size: 1.1rem;
    color: #ffffff;
    font-weight: 600;
    margin-bottom: 0.5rem;
}

.type-description {
    font-size: 0.9rem;
    color: rgba(255, 255, 255, 0.8);
    line-height: 1.4;
}

/* Center Panel - Main Editor */
.main-editor {
    background: rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(15px);
    border-radius: 20px;
    padding: 2rem;
    border: 1px solid rgba(255, 255, 255, 0.2);
}

.editor-tabs {
    display: flex;
    gap: 1rem;
    margin-bottom: 2rem;
    border-bottom: 2px solid rgba(255, 255, 255, 0.2);
    padding-bottom: 1rem;
}

.tab-button {
    padding: 0.75rem 1.5rem;
    background: rgba(255, 255, 255, 0.1);
    color: rgba(255, 255, 255, 0.8);
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 10px 10px 0 0;
    cursor: pointer;
    transition: all 0.3s ease;
    font-weight: 500;
}

.tab-button:hover {
    background: rgba(255, 255, 255, 0.15);
}

.tab-button.active {
    background: rgba(255, 255, 255, 0.2);
    color: #ffffff;
    border-bottom-color: transparent;
}

.tab-content {
    display: none;
}

.tab-content.active {
    display: block;
}

.input-section {
    margin-bottom: 2rem;
}

.input-label {
    display: block;
    color: #ffffff;
    font-weight: 600;
    margin-bottom: 0.5rem;
}

.text-input {
    width: 100%;
    min-height: 150px;
    background: rgba(255, 255, 255, 0.95);
    color: #000000;
    border: 2px solid rgba(255, 255, 255, 0.3);
    border-radius: 10px;
    padding: 1rem;
    font-size: 1rem;
    resize: vertical;
    font-family: 'Georgia', serif;
}

.text-input:focus {
    outline: none;
    border-color: var(--poetry-gold);
    box-shadow: 0 0 0 3px rgba(255, 193, 7, 0.2);
}

.transform-controls {
    display: flex;
    gap: 1rem;
    margin-bottom: 1rem;
}

.transform-btn {
    flex: 1;
    padding: 0.75rem;
    background: linear-gradient(135deg, var(--poetry-blue) 0%, var(--poetry-teal) 100%);
    color: white;
    border: none;
    border-radius: 10px;
    cursor: pointer;
    font-weight: 600;
    transition: all 0.3s ease;
}

.transform-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(0,0,0,0.3);
}

.poem-output {
    background: rgba(255, 255, 255, 0.95);
    color: #000000;
    border-radius: 10px;
    padding: 2rem;
    min-height: 300px;
    white-space: pre-wrap;
    font-family: 'Georgia', serif;
    font-size: 1.1rem;
    line-height: 1.8;
    border: 2px solid rgba(255, 255, 255, 0.3);
}

.poem-output.empty {
    color: #999;
    text-align: center;
    display: flex;
    align-items: center;
    justify-content: center;
    font-style: italic;
}

/* Right Panel - Poetry Notebook */
.poetry-notebook {
    background: rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(15px);
    border-radius: 20px;
    padding: 2rem;
    border: 1px solid rgba(255, 255, 255, 0.2);
}

.notebook-entry {
    background: rgba(255, 255, 255, 0.1);
    border-radius: 10px;
    padding: 1rem;
    margin-bottom: 1rem;
    border: 1px solid rgba(255, 255, 255, 0.2);
}

.entry-timestamp {
    font-size: 0.8rem;
    color: rgba(255, 255, 255, 0.6);
    margin-bottom: 0.5rem;
}

.entry-content {
    color: #ffffff;
    line-height: 1.6;
}

.entry-actions {
    display: flex;
    gap: 0.5rem;
    margin-top: 0.5rem;
}

.entry-btn {
    padding: 0.3rem 0.6rem;
    background: rgba(255, 255, 255, 0.2);
    color: #ffffff;
    border: 1px solid rgba(255, 255, 255, 0.3);
    border-radius: 5px;
    cursor: pointer;
    font-size: 0.85rem;
    transition: all 0.3s ease;
}

.entry-btn:hover {
    background: rgba(255, 255, 255, 0.3);
}

/* Poetry Tips */
.poetry-tips {
    margin-top: 2rem;
    padding: 1.5rem;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 15px;
    border: 1px solid rgba(255, 255, 255, 0.2);
}

.tip-title {
    color: var(--poetry-gold);
    font-weight: 600;
    margin-bottom: 0.5rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.tip-content {
    color: rgba(255, 255, 255, 0.9);
    line-height: 1.6;
    font-size: 0.95rem;
}

.action-buttons {
    display: flex;
    gap: 1rem;
    margin-top: 1.5rem;
}

.action-btn {
    flex: 1;
    padding: 0.75rem;
    border-radius: 10px;
    border: none;
    cursor: pointer;
    font-weight: 600;
    transition: all 0.3s ease;
}

.save-btn {
    background: linear-gradient(135deg, var(--poetry-purple) 0%, var(--poetry-pink) 100%);
    color: white;
}

.copy-btn {
    background: rgba(255, 255, 255, 0.2);
    color: white;
    border: 1px solid rgba(255, 255, 255, 0.3);
}

.clear-btn {
    background: rgba(239, 68, 68, 0.2);
    color: white;
    border: 1px solid rgba(239, 68, 68, 0.3);
}

@keyframes fadeInDown {
    from {
        opacity: 0;
        transform: translateY(-20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

@media (max-width: 1024px) {
    .workshop-container {
        grid-template-columns: 1fr;
    }
}

.poetry-badge {
    display: inline-block;
    padding: 0.2rem 0.5rem;
    background: var(--poetry-gold);
    color: #000;
    border-radius: 12px;
    font-size: 0.7rem;
    font-weight: 600;
    margin-left: 0.5rem;
    text-transform: capitalize;
}

.notification {
    position: fixed;
    top: 20px;
    right: 20px;
    padding: 1rem 1.5rem;
    border-radius: 10px;
    color: white;
    font-weight: 500;
    z-index: 1000;
    animation: slideIn 0.3s ease;
    box-shadow: 0 4px 15px rgba(0,0,0,0.2);
}

.notification.success {
    background: linear-gradient(135deg, #4CAF50, #45a049);
}

.notification.warning {
    background: linear-gradient(135deg, #ff9800, #f57c00);
}

.notification.error {
    background: linear-gradient(135deg, #f44336, #d32f2f);
}

@keyframes slideIn {
    from {
        transform: translateX(100%);
        opacity: 0;
    }
    to {
        transform: translateX(0);
        opacity: 1;
    }
}

.quick-idea-input {
    width: 100%;
    padding: 0.75rem;
    background: rgba(255, 255, 255, 0.95);
    border: 2px solid rgba(255, 255, 255, 0.3);
    border-radius: 10px;
    margin-bottom: 1rem;
    font-size: 0.95rem;
    color: #000;
}

.notebook-toolbar {
    display: flex;
    gap: 0.5rem;
    margin-bottom: 1rem;
    flex-wrap: wrap;
}

.toolbar-btn {
    padding: 0.5rem 1rem;
    background: rgba(255, 255, 255, 0.1);
    color: white;
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 8px;
    cursor: pointer;
    font-size: 0.9rem;
    transition: all 0.3s ease;
}

.toolbar-btn:hover {
    background: rgba(255, 255, 255, 0.2);
    transform: translateY(-2px);
}

.toolbar-btn.active {
    background: var(--poetry-gold);
    color: #000;
}
</style>

<div class="poetry-workshop">
    <div class="workshop-header">
        <h1 class="workshop-title">ðŸŽ­ Poetry Workshop</h1>
        <p class="workshop-subtitle">Transform words into art, create beautiful verses</p>
    </div>

    <div class="workshop-container">
        <!-- Left Panel - Poetry Types -->
        <div class="poetry-types">
            <h2 class="section-title">
                <i class="fas fa-feather-alt"></i>
                Poetry Forms
            </h2>
            
            <div class="poetry-type-card active" onclick="selectPoetryType('haiku')">
                <div class="type-name">Haiku</div>
                <div class="type-description">Traditional Japanese form: 5-7-5 syllables</div>
            </div>
            
            <div class="poetry-type-card" onclick="selectPoetryType('sonnet')">
                <div class="type-name">Sonnet</div>
                <div class="type-description">14 lines of iambic pentameter</div>
            </div>
            
            <div class="poetry-type-card" onclick="selectPoetryType('freeverse')">
                <div class="type-name">Free Verse</div>
                <div class="type-description">Unrestricted poetic expression</div>
            </div>
            
            <div class="poetry-type-card" onclick="selectPoetryType('limerick')">
                <div class="type-name">Limerick</div>
                <div class="type-description">Humorous 5-line AABBA rhyme</div>
            </div>
            
            <div class="poetry-type-card" onclick="selectPoetryType('tanka')">
                <div class="type-name">Tanka</div>
                <div class="type-description">Japanese form: 5-7-5-7-7 syllables</div>
            </div>
            
            <div class="poetry-type-card" onclick="selectPoetryType('acrostic')">
                <div class="type-name">Acrostic</div>
                <div class="type-description">First letters spell out a word</div>
            </div>

            <div class="poetry-tips">
                <div class="tip-title">
                    <i class="fas fa-lightbulb"></i>
                    Poetry Tip
                </div>
                <div class="tip-content" id="poetry-tip">
                    Haiku captures a moment in nature. Focus on sensory details and present tense. The last line often provides insight or surprise.
                </div>
            </div>
        </div>

        <!-- Center Panel - Main Editor -->
        <div class="main-editor">
            <div class="editor-tabs">
                <button class="tab-button active" onclick="switchTab('create')">Create Poetry</button>
                <button class="tab-button" onclick="switchTab('transform')">Transform Text</button>
                <button class="tab-button" onclick="switchTab('workshop')">Writing Workshop</button>
            </div>

            <!-- Create Poetry Tab -->
            <div class="tab-content active" id="create-tab">
                <div class="input-section">
                    <label class="input-label">Write Your Poem</label>
                    <textarea class="text-input" id="poem-input" placeholder="Start writing your poem here..."></textarea>
                </div>
                
                <div class="action-buttons">
                    <button class="action-btn save-btn" onclick="saveToNotebook()">
                        <i class="fas fa-save"></i> Save to Notebook
                    </button>
                    <button class="action-btn copy-btn" onclick="copyPoem()">
                        <i class="fas fa-copy"></i> Copy
                    </button>
                    <button class="action-btn clear-btn" onclick="clearPoem()">
                        <i class="fas fa-eraser"></i> Clear
                    </button>
                </div>
            </div>

            <!-- Transform Text Tab -->
            <div class="tab-content" id="transform-tab">
                <div class="input-section">
                    <label class="input-label">Paste Any Text (Even Boring Text!)</label>
                    <textarea class="text-input" id="transform-input" placeholder="Paste any text here - technical documentation, emails, instructions - anything! AI will transform it into beautiful poetry..."></textarea>
                </div>
                
                <div class="transform-controls">
                    <button class="transform-btn" onclick="transformToPoem('haiku')">
                        <i class="fas fa-magic"></i> Make Haiku
                    </button>
                    <button class="transform-btn" onclick="transformToPoem('sonnet')">
                        <i class="fas fa-scroll"></i> Make Sonnet
                    </button>
                    <button class="transform-btn" onclick="transformToPoem('freeverse')">
                        <i class="fas fa-feather"></i> Make Free Verse
                    </button>
                </div>
                
                <div class="input-section">
                    <label class="input-label">AI-Generated Poetry</label>
                    <div class="poem-output empty" id="transform-output">
                        Your transformed poetry will appear here...
                    </div>
                </div>
                
                <div class="action-buttons">
                    <button class="action-btn save-btn" onclick="saveTransformed()">
                        <i class="fas fa-save"></i> Save to Notebook
                    </button>
                    <button class="action-btn copy-btn" onclick="copyTransformed()">
                        <i class="fas fa-copy"></i> Copy
                    </button>
                </div>
            </div>

            <!-- Writing Workshop Tab -->
            <div class="tab-content" id="workshop-tab">
                <div class="input-section">
                    <label class="input-label">Poetry Writing Exercises</label>
                    <div class="poem-output" id="exercise-content">
                        <h3>Today's Exercise: Sensory Poetry</h3>
                        <p>Write a poem using all five senses about a single moment:</p>
                        <ul>
                            <li>What do you see?</li>
                            <li>What do you hear?</li>
                            <li>What do you smell?</li>
                            <li>What do you taste?</li>
                            <li>What do you feel?</li>
                        </ul>
                        <p>Example theme: Morning coffee, sunset walk, rainy day...</p>
                    </div>
                </div>
                
                <div class="transform-controls">
                    <button class="transform-btn" onclick="getNewExercise()">
                        <i class="fas fa-dice"></i> New Exercise
                    </button>
                    <button class="transform-btn" onclick="getPrompt()">
                        <i class="fas fa-lightbulb"></i> Get Prompt
                    </button>
                    <button class="transform-btn" onclick="getRhymes()">
                        <i class="fas fa-music"></i> Rhyme Helper
                    </button>
                </div>
            </div>
        </div>

        <!-- Right Panel - Poetry Notebook -->
        <div class="poetry-notebook">
            <h2 class="section-title">
                <i class="fas fa-book"></i>
                Poetry Notebook
            </h2>
            
            <div id="notebook-entries">
                <div class="notebook-entry">
                    <div class="entry-timestamp">Welcome to your Poetry Notebook!</div>
                    <div class="entry-content">Your poems will be saved here. Each entry is timestamped and can be copied or deleted.</div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
let currentPoetryType = 'haiku';
let notebookEntries = JSON.parse(localStorage.getItem('poetryNotebook') || '[]');

const poetryTips = {
    haiku: "Haiku captures a moment in nature. Focus on sensory details and present tense. The last line often provides insight or surprise.",
    sonnet: "Sonnets explore a single theme or emotion. Use iambic pentameter (da-DUM da-DUM) and consider the traditional rhyme scheme ABAB CDCD EFEF GG.",
    freeverse: "Free verse allows complete freedom. Focus on imagery, rhythm, and line breaks. Let your emotions guide the structure.",
    limerick: "Limericks are playful and humorous. Lines 1, 2, and 5 rhyme and have 7-10 syllables. Lines 3 and 4 rhyme and have 5-7 syllables.",
    tanka: "Tanka expands on haiku's nature themes to include human emotions. The last two lines often provide reflection or response.",
    acrostic: "Choose a word or phrase for your spine. Each line should relate to your theme while beginning with the appropriate letter."
};

const exercises = [
    {
        title: "Color Emotions",
        content: "Choose a color and write a poem about it without using the color's name. Describe emotions, memories, and sensations it evokes."
    },
    {
        title: "Object Persona",
        content: "Write from the perspective of an everyday object. What does a coffee mug think about? What stories would a door tell?"
    },
    {
        title: "Memory Snapshot",
        content: "Recall a specific moment from childhood. Write a poem focusing on one small detail from that memory."
    },
    {
        title: "Nature's Metaphors",
        content: "Look outside and find something in nature. Use it as a metaphor for a human experience or emotion."
    },
    {
        title: "Sound Poetry",
        content: "Write a poem focusing entirely on sounds. Use onomatopoeia, alliteration, and rhythm to create an auditory experience."
    }
];

function selectPoetryType(type) {
    currentPoetryType = type;
    document.querySelectorAll('.poetry-type-card').forEach(card => {
        card.classList.remove('active');
    });
    event.target.closest('.poetry-type-card').classList.add('active');
    
    document.getElementById('poetry-tip').textContent = poetryTips[type];
}

function switchTab(tab) {
    document.querySelectorAll('.tab-button').forEach(btn => {
        btn.classList.remove('active');
    });
    document.querySelectorAll('.tab-content').forEach(content => {
        content.classList.remove('active');
    });
    
    event.target.classList.add('active');
    document.getElementById(tab + '-tab').classList.add('active');
}

async function transformToPoem(style) {
    const input = document.getElementById('transform-input').value;
    if (!input) {
        showNotification('Please enter some text to transform!', 'warning');
        return;
    }
    
    const output = document.getElementById('transform-output');
    output.classList.remove('empty');
    output.innerHTML = '<i class="fas fa-spinner fa-spin"></i> AI is crafting your poem...';
    
    try {
        // Check if we have AI API available
        if (typeof window.generateAIPoem === 'function') {
            const poem = await window.generateAIPoem(input, style);
            output.textContent = poem;
        } else {
            // Fallback to enhanced local generation
            setTimeout(() => {
                let poem = '';
                if (style === 'haiku') {
                    poem = generateEnhancedHaiku(input);
                } else if (style === 'sonnet') {
                    poem = generateEnhancedSonnet(input);
                } else if (style === 'limerick') {
                    poem = generateLimerick(input);
                } else {
                    poem = generateEnhancedFreeVerse(input);
                }
                output.textContent = poem;
                showNotification('Poetry transformed successfully!', 'success');
            }, 1500);
        }
    } catch (error) {
        console.error('Error transforming text:', error);
        output.textContent = 'Error generating poem. Please try again.';
        showNotification('Error generating poem', 'error');
    }
}

function generateEnhancedHaiku(text) {
    // Enhanced haiku generation with better word extraction
    const words = text.toLowerCase().split(/\s+/).filter(w => w.length > 2);
    const nouns = words.filter(w => w.length > 4).slice(0, 3);
    const verbs = words.filter(w => w.endsWith('ing') || w.endsWith('ed')).slice(0, 2);
    
    const templates = [
        `${nouns[0] || 'morning'} ${verbs[0] || 'whispers'} soft\n${nouns[1] || 'silence'} holds the ${nouns[2] || 'moment'} close\n${words[words.length-1] || 'peace'} returns at last`,
        `Through ${nouns[0] || 'shadows'} dancing\n${verbs[0] || 'breathing'} in the ${nouns[1] || 'twilight'} hour\n${nouns[2] || 'dreams'} take their first flight`,
        `${words[0] || 'Ancient'} ${nouns[0] || 'wisdom'} speaks\nIn ${verbs[0] || 'falling'} ${nouns[1] || 'petals'} soft\n${nouns[2] || 'Truth'} reveals itself`
    ];
    
    return templates[Math.floor(Math.random() * templates.length)];
}

function generateLimerick(text) {
    const words = text.split(/\s+/).filter(w => w.length > 2);
    const place = words.find(w => w[0] === w[0].toUpperCase()) || 'Peru';
    const action = words.find(w => w.endsWith('ing')) || 'dancing';
    
    return `There once was a writer from ${place}\n` +
           `Who loved ${action} in morning dew\n` +
           `They'd spin tales so bright\n` +
           `From morning to night\n` +
           `And craft verses both ancient and new`;
}

function generateSonnetFromText(text) {
    return `Upon this page where simple words once lay,\n` +
           `Transform they must to verses sweet and true,\n` +
           `From mundane text to poetry's display,\n` +
           `Where beauty blooms in morning's gentle dew.\n\n` +
           `The ordinary takes on wings to soar,\n` +
           `Above the realm of everyday discourse,\n` +
           `To find within its heart a golden core,\n` +
           `That speaks of life's most fundamental force.\n\n` +
           `So let these transformed words now sing their song,\n` +
           `Of hope and dreams that dwell within the heart,\n` +
           `Where poetry and life do both belong,\n` +
           `United, never meant to be apart.\n\n` +
           `For in this transformation we can see,\n` +
           `That beauty lives in all, waiting to be free.`;
}

function generateEnhancedFreeVerse(text) {
    const sentences = text.match(/[^.!?]+[.!?]+/g) || [text];
    const words = text.split(/\s+/);
    const emotionalWords = words.filter(w => 
        ['love', 'hope', 'dream', 'fear', 'joy', 'pain', 'light', 'dark'].some(emo => 
            w.toLowerCase().includes(emo)
        )
    );
    
    const themes = emotionalWords.length > 0 ? emotionalWords : words.filter(w => w.length > 5);
    
    return `In the space between wordsâ€”\n\n` +
           `${sentences[0] ? sentences[0].trim() : words.slice(0, 8).join(' ')}\n\n` +
           `becomes\n\n` +
           `something\n` +
           `more than meaning,\n` +
           `more than sound.\n\n` +
           `${themes[0] || 'Truth'} whispers\n` +
           `in the margins,\n` +
           `${themes[1] || 'beauty'} dwells\n` +
           `in the pause,\n\n` +
           `and we find ourselves\n` +
           `transformed\n` +
           `by the simple act\n` +
           `of seeing\n` +
           `what was always there.`;
}

function generateEnhancedSonnet(text) {
    const words = text.split(/\s+/).filter(w => w.length > 2);
    const theme = words[0] || 'love';
    const subjects = words.filter(w => w[0] === w[0].toUpperCase()).slice(0, 3);
    
    return `Upon this canvas where ${theme} takes its form,\n` +
           `Where simple words transform to verses true,\n` +
           `From depths of thought, through literary storm,\n` +
           `Emerges beauty, fresh as morning dew.\n\n` +
           `The ${subjects[0] || 'heart'} speaks volumes in its silent way,\n` +
           `While ${subjects[1] || 'time'} moves forward with its steady pace,\n` +
           `Each moment holds the promise of the day,\n` +
           `Each word a thread in poetry's embrace.\n\n` +
           `So let these transformed verses sing their song,\n` +
           `Of ${subjects[2] || 'dreams'} that dwell within the writer's heart,\n` +
           `Where ordinary words do now belong,\n` +
           `In realms where science meets with sacred art.\n\n` +
           `For in this transformation we can see,\n` +
           `That poetry lives everywhere, waiting to be free.`;
}

function saveToNotebook() {
    const poem = document.getElementById('poem-input').value;
    if (!poem) {
        showNotification('Please write a poem first!', 'warning');
        return;
    }
    
    addToNotebook(poem, 'poem');
    showNotification('Poem saved to notebook!', 'success');
    
    // Clear draft after saving
    localStorage.removeItem('poetryDraft');
}

function saveTransformed() {
    const poem = document.getElementById('transform-output').textContent;
    if (poem.includes('will appear here')) {
        showNotification('Please transform some text first!', 'warning');
        return;
    }
    
    addToNotebook(poem, 'poem');
    showNotification('Transformed poem saved!', 'success');
}

function addToNotebook(content, type = 'poem') {
    const timestamp = new Date().toLocaleString();
    const entry = {
        timestamp: timestamp,
        content: content,
        type: type,
        poetryForm: currentPoetryType,
        id: Date.now()
    };
    
    notebookEntries.push(entry);
    saveNotebookToStorage();
    renderNotebook();
}

function saveNotebookToStorage() {
    localStorage.setItem('poetryNotebook', JSON.stringify(notebookEntries));
}

function renderNotebook() {
    const container = document.getElementById('notebook-entries');
    if (notebookEntries.length === 0) {
        container.innerHTML = `
            <div class="notebook-entry">
                <div class="entry-timestamp">Welcome to your Poetry Notebook!</div>
                <div class="entry-content">Your poems will be saved here. Each entry is timestamped and can be copied, edited, or deleted.</div>
            </div>
        `;
        return;
    }
    
    container.innerHTML = notebookEntries.slice().reverse().map(entry => `
        <div class="notebook-entry" data-type="${entry.type || 'poem'}">
            <div class="entry-timestamp">
                ${entry.timestamp}
                ${entry.poetryForm ? `<span class="poetry-badge">${entry.poetryForm}</span>` : ''}
            </div>
            <div class="entry-content">${entry.content.replace(/\n/g, '<br>')}</div>
            <div class="entry-actions">
                <button class="entry-btn" onclick="editEntry(${entry.id})">
                    <i class="fas fa-edit"></i> Edit
                </button>
                <button class="entry-btn" onclick="copyEntry(${entry.id})">
                    <i class="fas fa-copy"></i> Copy
                </button>
                <button class="entry-btn" onclick="deleteEntry(${entry.id})">
                    <i class="fas fa-trash"></i> Delete
                </button>
            </div>
        </div>
    `).join('');
}

function copyEntry(id) {
    const entry = notebookEntries.find(e => e.id === id);
    if (entry) {
        navigator.clipboard.writeText(entry.content);
        showNotification('Entry copied to clipboard!', 'success');
    }
}

function deleteEntry(id) {
    if (confirm('Are you sure you want to delete this poem?')) {
        notebookEntries = notebookEntries.filter(e => e.id !== id);
        saveNotebookToStorage();
        renderNotebook();
    }
}

function editEntry(id) {
    const entry = notebookEntries.find(e => e.id === id);
    if (entry) {
        const newContent = prompt('Edit your poem:', entry.content);
        if (newContent !== null && newContent !== entry.content) {
            entry.content = newContent;
            entry.timestamp = new Date().toLocaleString() + ' (edited)';
            saveNotebookToStorage();
            renderNotebook();
        }
    }
}

function copyPoem() {
    const poem = document.getElementById('poem-input').value;
    if (!poem) {
        showNotification('Nothing to copy!', 'warning');
        return;
    }
    navigator.clipboard.writeText(poem);
    showNotification('Poem copied to clipboard!', 'success');
}

function copyTransformed() {
    const poem = document.getElementById('transform-output').textContent;
    if (poem.includes('will appear here')) {
        showNotification('Nothing to copy!', 'warning');
        return;
    }
    navigator.clipboard.writeText(poem);
    showNotification('Poem copied to clipboard!', 'success');
}

function clearPoem() {
    document.getElementById('poem-input').value = '';
}

function getNewExercise() {
    const exercise = exercises[Math.floor(Math.random() * exercises.length)];
    document.getElementById('exercise-content').innerHTML = `
        <h3>Today's Exercise: ${exercise.title}</h3>
        <p>${exercise.content}</p>
    `;
}

function getPrompt() {
    const prompts = [
        "Write about the last thing that made you smile",
        "Describe a storm without using weather words",
        "Write a love poem to your morning coffee",
        "Capture the feeling of Sunday afternoon",
        "Write about a goodbye that never happened"
    ];
    
    const prompt = prompts[Math.floor(Math.random() * prompts.length)];
    alert(`Writing Prompt: ${prompt}`);
}

function getRhymes() {
    const word = prompt("Enter a word to find rhymes:");
    if (word) {
        // In production, this would call a rhyming API
        const rhymes = ['day', 'way', 'say', 'play', 'stay', 'may', 'ray', 'bay'];
        alert(`Rhymes for "${word}": ${rhymes.join(', ')}`);
    }
}
// Initialize notebook on page load
window.addEventListener('DOMContentLoaded', () => {
    renderNotebook();
    
    // Set default filter to 'all'
    document.getElementById('filter-all')?.classList.add('active');
    
    // Auto-save current poem every 30 seconds
    setInterval(() => {
        const poem = document.getElementById('poem-input')?.value;
        if (poem && poem.length > 50) {
            localStorage.setItem('poetryDraft', poem);
        }
    }, 30000);
    
    // Restore draft if exists
    const draft = localStorage.getItem('poetryDraft');
    if (draft) {
        const input = document.getElementById('poem-input');
        if (input && !input.value) {
            input.value = draft;
            showNotification('Draft restored from last session', 'success');
        }
    }
});

// Keyboard shortcuts
document.addEventListener('keydown', (e) => {
    // Ctrl/Cmd + S to save
    if ((e.ctrlKey || e.metaKey) && e.key === 's') {
        e.preventDefault();
        saveToNotebook();
    }
    
    // Ctrl/Cmd + Shift + C to copy
    if ((e.ctrlKey || e.metaKey) && e.shiftKey && e.key === 'C') {
        e.preventDefault();
        copyPoem();
    }
});
</script>

{% endblock %}